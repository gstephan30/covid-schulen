ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten")
data %>%
mutate(key = paste0(type, "_", quantile)) %>%
select(target_week, location, key, value) %>%
filter(location == country_code) %>%
mutate(value = as.numeric(value)) %>%
pivot_wider(names_from = key, values_from = value) %>%
bind_rows(time_kmk %>%
filter(location == country_code) %>%
select(target_week = week,
location, point_NA = any_of(sub_set)) %>%
mutate(point_NA = ifelse(point_NA == "-", NA, point_NA),
point_NA = as.numeric(point_NA)))
View(forecast_students)
data %>%
mutate(key = paste0(type, "_", quantile)) %>%
select(target_week, location, key, value) %>%
filter(location == country_code) %>%
mutate(value = as.numeric(value)) %>%
pivot_wider(names_from = key, values_from = value) %>%
bind_rows(time_kmk %>%
filter(location == country_code) %>%
select(target_week = week,
location, point_NA = any_of(sub_set)) %>%
mutate(point_NA = ifelse(point_NA == "-", NA, point_NA),
point_NA = as.numeric(point_NA))) %>%
mutate(target_week = ifelse(nchar(target_week) == 1, paste0("0", target_week), target_week),
target_week = paste0("2021-KW", target_week))
data %>%
mutate(key = paste0(type, "_", quantile)) %>%
select(target_week, location, key, value) %>%
filter(location == country_code) %>%
mutate(value = as.numeric(value)) %>%
pivot_wider(names_from = key, values_from = value) %>%
bind_rows(time_kmk %>%
filter(location == country_code) %>%
select(target_week = week,
location, point_NA = any_of(sub_set)) %>%
mutate(point_NA = ifelse(point_NA == "-", NA, point_NA),
point_NA = as.numeric(point_NA))) %>%
mutate(target_week = ifelse(nchar(target_week) == 1, paste0("0", target_week), target_week),
target_week = paste0("2021-KW", target_week)) %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten")
data %>%
mutate(key = paste0(type, "_", quantile)) %>%
select(target_week, location, key, value) %>%
filter(location == country_code) %>%
mutate(value = as.numeric(value)) %>%
pivot_wider(names_from = key, values_from = value) %>%
bind_rows(time_kmk %>%
filter(location == country_code) %>%
select(target_week = week,
location, point_NA = any_of(sub_set)) %>%
mutate(point_NA = ifelse(point_NA == "-", NA, point_NA),
point_NA = as.numeric(point_NA))) %>%
mutate(target_week = ifelse(nchar(target_week) == 1, paste0("0", target_week), target_week),
target_week = paste0("2021-KW", target_week)) %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
data %>%
mutate(key = paste0(type, "_", quantile)) %>%
select(target_week, location, key, value) %>%
filter(location == country_code) %>%
mutate(value = as.numeric(value)) %>%
pivot_wider(names_from = key, values_from = value) %>%
bind_rows(time_kmk %>%
filter(location == country_code) %>%
select(target_week = week,
location, point_NA = any_of(sub_set)) %>%
mutate(point_NA = ifelse(point_NA == "-", NA, point_NA),
point_NA = as.numeric(point_NA))) %>%
mutate(target_week = ifelse(nchar(target_week) == 1, paste0("0", target_week), target_week),
target_week = paste0("2021-KW", target_week)) %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_continuous(breaks = scales::breaks_pretty(1))
plot_data <- data %>%
mutate(key = paste0(type, "_", quantile)) %>%
select(target_week, location, key, value) %>%
filter(location == country_code) %>%
mutate(value = as.numeric(value)) %>%
pivot_wider(names_from = key, values_from = value) %>%
bind_rows(time_kmk %>%
filter(location == country_code) %>%
select(target_week = week,
location, point_NA = any_of(sub_set)) %>%
mutate(point_NA = ifelse(point_NA == "-", NA, point_NA),
point_NA = as.numeric(point_NA))) %>%
mutate(target_week = ifelse(nchar(target_week) == 1, paste0("0", target_week), target_week),
target_week = paste0("2021-KW", target_week))
plot_data
plot_data$target_week
sort(plot_data$target_week)
sort(plot_data$target_week) %>% cut(3)
sort(plot_data$target_week) %>% cut(., 3)
plot_data %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_continuous(breaks = seq(min(plot_data$target_week),
max(plot_data$target_week), 5))
seq(min(plot_data$target_week),
max(plot_data$target_week), 5)
min(plot_data$target_week)
max(plot_data$target_week)
seq(min(plot_data$target_week),
max(plot_data$target_week), 1)
min(plot_data$target_week)
x_axis <- plot_data$target_week
x_axis[seq(1, length(x_axis), 3)]
x_axis[seq(1, length(x_axis), 4)]
x_axis <- sort(plot_data$target_week)
x_axis[seq(1, length(x_axis), 4)]
x_axis[seq(1, length(x_axis), 5)]
plot_data %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_continuous(breaks =   x_axis[seq(1, length(x_axis), 5)])
x_axis[seq(1, length(x_axis), 5)]
plot_data %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1, group = target_week) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data
plot_data %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1, aes(group = target_week)) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data
plot_data %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1, group = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA, group = 1)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA, group = 1)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA, group = 1)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA, group = 1)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA, group = 1)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0,5)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA, group = 1)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0.5)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA, group = 1)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 45, vjust = 0, hjust = 0.5)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
plot_data %>%
ggplot(aes(x = target_week, y = point_NA, group = 1)) +
geom_ribbon(
aes(ymin = quantile_0.025,
ymax = quantile_0.975),
alpha = 0.25,
fill = "#27408b"
) +
geom_ribbon(aes(ymin = quantile_0.25,
ymax = quantile_0.75),
alpha = 0.25,
fill = "#27408b") +
geom_point(color = "#27408b", size = 3) +
geom_line(color = "#27408b", size = 1) +
theme_light(base_size = 30) +
labs(x = "Kalenderwoche",
y = "Anzahl der Infizierten") +
theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0.5)) +
scale_x_discrete(breaks = x_axis[seq(1, length(x_axis), 5)])
tab_students
library(dplyr)
library(stringr)
library(lubridate)
library(purrr)
library(tidyr)
kpi_bl <- list.files(path = "data_clean/", pattern = "kmkdata_bl.rds", full.names = TRUE) %>%
as_tibble() %>%
rename(file = value) %>%
mutate(datum = str_extract(file, "[0-9]{8}"),
datum = ymd(datum)) %>%
arrange(desc(datum)) %>%
pull(file) %>%
.[1] %>%
readRDS()
tab_students <- kpi_bl %>%
select(NAME_1, contains("students"), -students_perc) %>%
mutate_if(is.numeric, ~round(., 4)) %>%
set_names("Bundesland", "Infizierte Schüler", "Infizierte Schüler in %",
"Schüler in Quaratäne", "Schüler in Quaratäne in %", "Gesamte Schüler") %>%
DT::datatable(options = list(pageLength = 16, dom = 'tip'))
tab_teacher <- kpi_bl %>%
select(NAME_1, contains("teacher"), -teacher_perc, -label_teacher) %>%
mutate_if(is.numeric, ~round(., 4)) %>%
set_names("Bundesland", "Infizierte Lehrkräfte", "Infizierte Lehrkräfte in %",
"Lehrkräfte in Quaratäne", "Lehrkräfte in Quaratäne in %", "Gesamte Lehrkräfte") %>%
DT::datatable(options = list(pageLength = 16, dom = 'tip'))
tab_teacher
kpi_bl
list.files(path = "data_clean/", pattern = "clean_kpi_bl", full.names = TRUE) %>%
as_tibble() %>%
rename(file = value) %>%
mutate(datum = str_extract(file, "[0-9]{8}"),
datum = ymd(datum)) %>%
arrange(desc(datum)) %>%
pull(file) %>%
.[1] %>%
readRDS()
kpi_kreis <- list.files(path = "data_clean/", pattern = "clean_kpi_bl", full.names = TRUE) %>%
as_tibble() %>%
rename(file = value) %>%
mutate(datum = str_extract(file, "[0-9]{8}"),
datum = ymd(datum)) %>%
arrange(desc(datum)) %>%
pull(file) %>%
.[1] %>%
readRDS()
kpi_kreis %>%
filter(year(data_date) == 2021) %>%
pivot_wider(
names_from = "category",
values_from = "value",
values_fill = 0
) %>%
separate(key, c("bl", "bl2"), remove = FALSE)
